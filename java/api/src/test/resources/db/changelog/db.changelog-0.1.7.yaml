databaseChangeLog:
  - changeSet:
      id: create-subject-table
      author: Shymanski Siarhei
      changes:
        - createTable:
            tableName: subject
            columns:
              - column:
                  name: id
                  type: uuid
              - column:
                  name: api_key
                  type: varchar(36)
              - column:
                  name: subject_name
                  type: varchar(255)
        - addPrimaryKey:
            columnNames: id
            constraintName: pk_subject
            tableName: subject
  - changeSet:
      id: create-img-table
      author: Shymanski Siarhei
      changes:
        - createTable:
            tableName: img
            columns:
              - column:
                  name: id
                  type: uuid
              - column:
                  name: content
                  type: bytea
              - column:
                  name: subject_id
                  type: uuid
        - addPrimaryKey:
            columnNames: id
            constraintName: pk_img
            tableName: img
        - addNotNullConstraint:
            tableName: img
            columnName: content
        - addForeignKeyConstraint:
            baseColumnNames: subject_id
            baseTableName: img
            referencedColumnNames: id
            referencedTableName: subject
            constraintName: fk_subject_id
            onDelete: CASCADE
            onUpdate: CASCADE
  - changeSet:
      id: create-embedding-table
      author: Shymanski Siarhei
      changes:
        - createTable:
            tableName: embedding
            columns:
              - column:
                  name: id
                  type: uuid
              - column:
                  name: subject_id
                  type: uuid
              - column:
                  name: embedding
                  type: float8[]
              - column:
                  name: calculator
                  type: varchar(255)
              - column:
                  name: img_id
                  type: uuid
        - addPrimaryKey:
            columnNames: id
            constraintName: pk_embedding
            tableName: embedding
        - addForeignKeyConstraint:
            baseColumnNames: subject_id
            baseTableName: embedding
            referencedColumnNames: id
            referencedTableName: subject
            constraintName: fk_subject_id
            onDelete: CASCADE
            onUpdate: CASCADE
        - addForeignKeyConstraint:
            baseColumnNames: img_id
            baseTableName: embedding
            referencedColumnNames: id
            referencedTableName: img
            constraintName: fk_img_id